import { CaseDefinition } from '@shadows/shared';

export const lanternFestival: CaseDefinition = {
  id: 'lantern-festival',
  title: '长安灯谜',
  setting: '唐朝长安，公元745年',
  synopsis: `上元灯节前夕，工部侍郎崔明远在归家途中离奇失踪。马车倾覆于朱雀大街，车帘染血，人却无影无踪。崔大人掌管即将完工的大明宫扩建工程，知晓宫中不少机密。是政敌暗害？是劫匪谋财？还是另有隐情？长安城中，灯火辉煌的背后，暗流涌动。`,

  atmosphere: '灯火阑珊处，长安城的繁华掩不住暗涌的杀机。坊间巷尾，窃窃私语；宫墙之内，讳莫如深。',
  solution:
    '太子李亨为扩充私军，暗中挪用大明宫工程款项。崔明远发现账目不符后，开始秘密调查。太子得知后派心腹假扮僧人与崔明远接触，试探其意图。当确认崔明远打算上报朝廷时，太子派遣豢养的胡人刺客将其劫杀。崔明远提前察觉危险，托西域商人转移家财，留下证据给妻子。真相指向东宫，但揭发皇储，后果难料。',

  npcs: [
    {
      id: 'lingyi',
      name: '苏玲仪',
      role: '崔明远之妻，名门闺秀',
      locationId: 'cui-residence',
      personality: {
        voice: '端庄得体，言辞温婉，却有主见',
        speechPatterns: [
          '称呼夫君为"郎君"或"老爷"',
          '说话委婉含蓄，点到为止',
          '情绪激动时会引用诗词',
        ],
        backstory:
          '出身名门，知书达礼。知道丈夫最近夜不归宿的真正原因，收到过神秘的恐吓书信，还发现丈夫书房有密藏的文书。外表镇定，内心惶恐不安。',
        mannerisms: [
          '说话时轻抚袖口',
          '提到丈夫时望向门外',
          '紧张时反复整理发簪',
        ],
      },
      relationships: [
        { npcId: 'weichen', nature: '丈夫的下属，偶有往来', knownByPlayer: false },
        { npcId: 'taijian', nature: '曾在宫中见过，心存戒备', knownByPlayer: false },
      ],
      knowledgeBoundaries: [
        {
          clueId: 'secret-letters',
          revealThreshold: 45,
          deflectionHint: '只说郎君"公务繁忙"',
          revealGuidance: '透露在香炉中发现被焚烧的书信残片',
        },
        {
          clueId: 'threatening-note-tang',
          revealThreshold: 55,
          deflectionHint: '显得忧虑但称"没什么大事"',
          revealGuidance: '拿出恐吓密函："令郎君速速抽身，否则玉石俱焚"',
        },
        {
          clueId: 'hidden-documents',
          revealThreshold: 70,
          deflectionHint: '称书房是"郎君的私地，妾身不敢擅入"',
          revealGuidance: '带领去书房暗格，取出详细记录工程真实开支的账册',
        },
      ],
      trustLevel: 35,
      mood: '担忧却强作镇定',
      introduced: false,
    },
    {
      id: 'weichen',
      name: '陈伟臣',
      role: '工部主事，崔明远下属',
      locationId: 'ministry-office',
      personality: {
        voice: '谨小慎微，说话留三分',
        speechPatterns: [
          '称上级为"大人"，自称"下官"',
          '爱用"恕下官直言"开头',
          '紧张时会结巴或重复',
        ],
        backstory:
          '勤勉的小官吏，发现工程款项有巨大亏空。知道崔明远与某位权贵有秘密往来。自己曾被人威胁要求做伪证——来人持宫中令牌。',
        mannerisms: [
          '说话时低头看脚尖',
          '提到工程问题时变得滔滔不绝',
          '听到脚步声会猛然回头',
        ],
      },
      relationships: [
        { npcId: 'lingyi', nature: '崔夫人，恭敬有加', knownByPlayer: false },
        { npcId: 'taijian', nature: '见过此人来找崔大人，心中畏惧', knownByPlayer: false },
      ],
      knowledgeBoundaries: [
        {
          clueId: 'fund-discrepancy',
          revealThreshold: 40,
          deflectionHint: '称"账目都是崔大人亲自过目的"',
          revealGuidance: '承认发现三十万贯预算只用了二十万贯',
        },
        {
          clueId: 'secret-meetings',
          revealThreshold: 60,
          deflectionHint: '说"下官只管分内之事"',
          revealGuidance: '透露撞见崔大人在城外与锦衣华服者密谈',
        },
        {
          clueId: 'coerced-witness',
          revealThreshold: 75,
          deflectionHint: '紧张地称"下官什么都不知道"',
          revealGuidance: '坦白被威胁做伪证，来人持宫中令牌',
        },
      ],
      trustLevel: 40,
      mood: '惶恐不安',
      introduced: false,
    },
    {
      id: 'huoji',
      name: '阿卜杜勒·火吉',
      role: '西域商人，常年来往长安',
      locationId: 'west-market',
      personality: {
        voice: '豪爽直率，带有胡人口音',
        speechPatterns: [
          '称呼人喜欢用"朋友""兄弟"',
          '爱用商人比喻：谈价格、论买卖',
          '中文流利但偶尔词序颠倒',
        ],
        backstory:
          '走丝绸之路二十年的老商人。崔明远托他秘密转移过一批财物到西域。在城外灞桥见过崔明远与一僧人密会。案发当晚听说有胡人骑士在朱雀大街出没。',
        mannerisms: [
          '说话时手舞足蹈',
          '提到故乡波斯时望向西方',
          '谈到钱财时眼睛发亮',
        ],
      },
      relationships: [
        { npcId: 'taijian', nature: '打过交道，知道此人手眼通天', knownByPlayer: false },
      ],
      knowledgeBoundaries: [
        {
          clueId: 'transferred-goods',
          revealThreshold: 50,
          deflectionHint: '只说与崔大人"做过几笔小买卖"',
          revealGuidance: '承认帮崔明远转移了价值万贯的金银细软',
        },
        {
          clueId: 'secret-rendezvous',
          revealThreshold: 65,
          deflectionHint: '称"在灞桥见过很多人"',
          revealGuidance: '描述崔明远与一位举止有贵气的僧人密谈',
        },
        {
          clueId: 'foreign-presence',
          revealThreshold: 45,
          deflectionHint: '说"那晚我在西市收货"',
          revealGuidance: '透露听闻有胡人骑士在案发地附近出没',
        },
      ],
      trustLevel: 30,
      mood: '热情但有所保留',
      introduced: false,
    },
    {
      id: 'taijian',
      name: '高公公',
      role: '大明宫内侍，皇帝近臣',
      locationId: 'palace-gate',
      personality: {
        voice: '阴柔圆滑，字字机锋',
        speechPatterns: [
          '自称"咱家"，称对方"这位"',
          '说话弯弯绕绕从不直接',
          '爱用"圣上的意思是..."来暗示',
        ],
        backstory:
          '宫中老人，消息灵通。崔明远发现了宫中某个大秘密。有人高价收买他提供崔明远动向，那人的随从腰间挂着东宫令牌。知道一位皇子与此事有关。',
        mannerisms: [
          '笑容不达眼底',
          '说话时抚摸拂尘',
          '提到皇帝时会压低声音',
        ],
      },
      relationships: [
        { npcId: 'weichen', nature: '知道此人在工部任职', knownByPlayer: false },
        { npcId: 'huoji', nature: '曾托此人采买西域珍玩', knownByPlayer: false },
      ],
      knowledgeBoundaries: [
        {
          clueId: 'palace-secret',
          revealThreshold: 70,
          deflectionHint: '只说"宫中之事，咱家不便多言"',
          revealGuidance: '暗示崔明远发现工程款被挪用到某位皇子私库',
        },
        {
          clueId: 'informant-payment',
          revealThreshold: 60,
          deflectionHint: '称"咱家只是伺候圣上的"',
          revealGuidance: '透露有人重金收买他密报崔明远行踪',
        },
        {
          clueId: 'prince-involvement',
          revealThreshold: 85,
          deflectionHint: '突然变得警惕，称"有些事不可说"',
          revealGuidance: '道出实情：太子挪用工程款扩充私军，崔明远发现后被灭口',
        },
      ],
      trustLevel: 20,
      mood: '讳莫如深',
      introduced: false,
    },
  ],

  locations: [
    {
      id: 'cui-residence',
      name: '崔府',
      description: '永乐坊内的三进大宅，雕梁画栋，却笼罩着不安的气氛。',
      atmosphere: '府中下人窃窃私语，夫人整日在佛堂焚香祈祷。管家的脚步匆匆，似有难言之隐。',
      npcIds: ['lingyi'],
      searchableClueIds: ['crime-scene'],
      connectedLocationIds: ['ministry-office', 'west-market', 'zhuque-street'],
      visited: false,
    },
    {
      id: 'ministry-office',
      name: '工部衙门',
      description: '皇城内的宏伟建筑，卷宗堆积如山，官员们埋头于案牍。',
      atmosphere: '自崔大人失踪后，人人自危。有人忙着销毁文书，有人急着撇清关系。空气中弥漫着墨香与恐惧。',
      npcIds: ['weichen'],
      searchableClueIds: ['fund-discrepancy'],
      connectedLocationIds: ['cui-residence', 'palace-gate'],
      visited: false,
    },
    {
      id: 'west-market',
      name: '西市',
      description: '胡商云集的繁华市场，波斯锦缎、西域香料、天竺宝石应有尽有。',
      atmosphere: '骆驼铃声叮当，各国语言交织。在这里，金钱能买到一切——包括消息和沉默。',
      npcIds: ['huoji'],
      searchableClueIds: ['transferred-goods'],
      connectedLocationIds: ['cui-residence', 'zhuque-street'],
      visited: false,
    },
    {
      id: 'palace-gate',
      name: '大明宫丹凤门',
      description: '大唐帝国的心脏入口，巍峨的城门彰显着皇权的威严。',
      atmosphere: '禁军甲胄鲜明，宫人进出匆匆。宫墙之内是另一个世界，普通人难以窥探其究竟。',
      npcIds: ['taijian'],
      searchableClueIds: [],
      connectedLocationIds: ['ministry-office'],
      visited: false,
    },
    {
      id: 'zhuque-street',
      name: '朱雀大街',
      description: '贯通长安南北的主街，宽阔如河，是那晚崔大人失踪的地点。',
      atmosphere: '事发地点已被官府封锁。青石板路上的血迹已被清洗，但车辙印痕犹在。附近坊民噤若寒蝉。',
      npcIds: [],
      searchableClueIds: ['foreign-presence'],
      connectedLocationIds: ['cui-residence', 'west-market', 'temple'],
      visited: false,
    },
    {
      id: 'temple',
      name: '大慈恩寺',
      description: '玄奘法师译经之所，香火鼎盛的佛门圣地。',
      atmosphere: '晨钟暮鼓，梵音缭绕。有传言说，事发当晚有人在此见过崔大人的身影。塔影婆娑，似藏玄机。',
      npcIds: [],
      searchableClueIds: ['secret-rendezvous'],
      connectedLocationIds: ['zhuque-street'],
      visited: false,
    },
  ],

  clues: [
    {
      id: 'crime-scene',
      name: '翻覆的马车',
      description: '车帘上有血迹，但不多。车厢内发现半枚玉佩，似是打斗中折断。崔大人常佩此玉。',
      sourceId: 'cui-residence',
      trustThreshold: 0,
      prerequisites: [],
      discovered: false,
      tags: ['physical'],
    },
    {
      id: 'secret-letters',
      name: '焚烧的书信',
      description: '夫人房中的香炉里发现未尽燃的纸灰，依稀可辨"大事将成""小心李..."几字。',
      sourceId: 'lingyi',
      trustThreshold: 45,
      prerequisites: ['crime-scene'],
      discovered: false,
      tags: ['document'],
    },
    {
      id: 'threatening-note-tang',
      name: '恐吓密函',
      description: '夫人收到的纸条："令郎君速速抽身，否则玉石俱焚。"字迹似出自宫中。',
      sourceId: 'lingyi',
      trustThreshold: 55,
      prerequisites: ['secret-letters'],
      discovered: false,
      tags: ['document'],
    },
    {
      id: 'hidden-documents',
      name: '密藏的账册',
      description: '崔明远书房暗格中的账本，详细记录了大明宫工程的真实开支——与呈报朝廷的数目相差甚远。',
      sourceId: 'lingyi',
      trustThreshold: 70,
      prerequisites: ['threatening-note-tang'],
      discovered: false,
      tags: ['document'],
    },
    {
      id: 'fund-discrepancy',
      name: '工程亏空',
      description: '大明宫扩建工程预算三十万贯，实际只用了二十万贯。那十万贯去了哪里？',
      sourceId: 'ministry-office',
      trustThreshold: 0,
      prerequisites: [],
      discovered: false,
      tags: ['document'],
    },
    {
      id: 'secret-meetings',
      name: '密会记录',
      description: '崔明远近三月每逢初一、十五深夜外出，去向不明。陈伟臣无意中撞见他在城外与锦衣华服者密谈。',
      sourceId: 'weichen',
      trustThreshold: 60,
      prerequisites: ['fund-discrepancy'],
      discovered: false,
      tags: ['testimony'],
    },
    {
      id: 'coerced-witness',
      name: '被迫的证人',
      description: '陈伟臣坦白：有人威胁他，若崔大人出事，必须作证说是自己贪污被发现后畏罪。来人持宫中令牌。',
      sourceId: 'weichen',
      trustThreshold: 75,
      prerequisites: ['secret-meetings', 'palace-secret'],
      discovered: false,
      tags: ['testimony'],
    },
    {
      id: 'transferred-goods',
      name: '转移的财物',
      description: '崔明远托火吉将一批"家传古董"运往西域，实为金银细软，价值不下万贯。',
      sourceId: 'west-market',
      trustThreshold: 0,
      prerequisites: [],
      discovered: false,
      tags: ['physical'],
    },
    {
      id: 'secret-rendezvous',
      name: '城外密会',
      description: '火吉在灞桥见过崔明远与一僧人密谈。那僧人似非普通沙门，举止间有贵气。',
      sourceId: 'huoji',
      trustThreshold: 65,
      prerequisites: ['transferred-goods', 'secret-meetings'],
      discovered: false,
      tags: ['testimony'],
    },
    {
      id: 'foreign-presence',
      name: '神秘胡人',
      description: '案发当晚，有人看见几个胡人骑士在朱雀大街附近出没，事后再无踪影。',
      sourceId: 'huoji',
      trustThreshold: 45,
      prerequisites: ['crime-scene'],
      discovered: false,
      tags: ['testimony'],
    },
    {
      id: 'palace-secret',
      name: '宫中隐秘',
      description: '高公公暗示：崔明远发现工程款被挪用去了不该去的地方——某位皇子的私库。',
      sourceId: 'taijian',
      trustThreshold: 70,
      prerequisites: ['hidden-documents', 'fund-discrepancy'],
      discovered: false,
      tags: ['testimony'],
    },
    {
      id: 'informant-payment',
      name: '线人的酬金',
      description: '有人出重金让高公公密报崔明远的行踪，那人的随从腰间挂着东宫的令牌。',
      sourceId: 'taijian',
      trustThreshold: 60,
      prerequisites: ['palace-secret'],
      discovered: false,
      tags: ['testimony'],
    },
    {
      id: 'prince-involvement',
      name: '皇子的阴谋',
      description: '高公公终于道出实情：太子为扩充私军挪用工程款，崔明远发现后欲上报，于是被灭口。那"僧人"正是太子心腹假扮。',
      sourceId: 'taijian',
      trustThreshold: 85,
      prerequisites: ['informant-payment', 'secret-rendezvous', 'coerced-witness'],
      discovered: false,
      tags: ['testimony'],
    },
  ],

  clueConnections: [
    { fromClueId: 'crime-scene', toClueId: 'secret-letters', relationship: '崔大人似有预感，提前做了安排' },
    { fromClueId: 'secret-letters', toClueId: 'threatening-note-tang', relationship: '有人想让他闭嘴' },
    { fromClueId: 'threatening-note-tang', toClueId: 'hidden-documents', relationship: '他藏了什么要命的东西？' },
    { fromClueId: 'fund-discrepancy', toClueId: 'palace-secret', relationship: '那十万贯去了谁的口袋？' },
    { fromClueId: 'transferred-goods', toClueId: 'secret-rendezvous', relationship: '崔明远在准备跑路？' },
    { fromClueId: 'palace-secret', toClueId: 'informant-payment', relationship: '有人在监视崔明远' },
    { fromClueId: 'secret-rendezvous', toClueId: 'prince-involvement', relationship: '那个"僧人"是谁？' },
    { fromClueId: 'informant-payment', toClueId: 'prince-involvement', relationship: '东宫——太子所居' },
    { fromClueId: 'foreign-presence', toClueId: 'prince-involvement', relationship: '太子豢养的胡人刺客' },
  ],
};
